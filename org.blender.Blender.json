{
    "id": "org.blender.Blender",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "22.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "blender",
    "rename-desktop-file": "blender.desktop",
    "rename-icon": "blender",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--device=dri",
        "--share=network",
        "--filesystem=host",
        "--env=TMP_DIR=/tmp",
        "--env=TMP=/tmp"
    ],
    "add-extensions": {
        "org.blender.Blender.Codecs": {
            "directory": "lib/codecs",
            "add-ld-path": "lib",
            "bundle": true,
            "autodelete": true
        },
        "org.freedesktop.Platform.ffmpeg-full": {
            "directory": "lib/ffmpeg",
            "version": "22.08",
            "add-ld-path": "."
        }
    },
    "cleanup-commands": [
        "mkdir -p /app/lib/ffmpeg"
    ],
    "modules": [
        "shared-modules/glu/glu-9.json",
        "shared-modules/glew/glew.json",
        {
            "name": "jemalloc",
            "config-opts": [
                "--disable-documentation",
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jemalloc/jemalloc/releases/download/5.2.1/jemalloc-5.2.1.tar.bz2",
                    "sha256": "34330e5ce276099e2e8950d9335db5a875689a4c6a56751ef3b1d8c537f887f6",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 1441,
                        "stable-only": true,
                        "url-template": "https://github.com/jemalloc/jemalloc/releases/download/$version/jemalloc-$version.tar.bz2"
                    }
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/*.a",
                "/lib/pkgconfig",
                "/share/doc",
                "/share/man"
            ]
        },
        {
            "name": "oneTBB",
            "buildsystem": "simple",
            "build-commands": [
                "make tbb tbbmalloc tbbproxy",
                "install -p -D -m755 build/linux_*_release/libtbb.so.2 /app/lib/libtbb.so.2",
                "ln -s libtbb.so.2 /app/lib/libtbb.so",
                "install -p -D -m755 build/linux_*_release/libtbbmalloc.so.2 /app/lib/libtbbmalloc.so.2",
                "ln -s libtbb.so.2 /app/lib/libtbbmalloc.so",
                "install -p -D -m755 build/linux_*_release/libtbbmalloc_proxy.so.2 /app/lib/libtbbmalloc_proxy.so.2",
                "ln -s libtbb.so.2 /app/lib/libtbbmalloc_proxy.so",
                "cp -dR --preserve=mode,timestamp include/tbb /app/include/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/oneapi-src/oneTBB/archive/2019_U9.tar.gz",
                    "sha256": "3f5ea81b9caa195f1967a599036b473b2e7c347117330cda99b79cfcf5b77c84",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 227581,
                        "stable-only": true,
                        "url-template": "https://github.com/oneapi-src/oneTBB/archive/v$version.tar.gz"
                    }
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        {
            "name": "boost",
            "buildsystem": "simple",
            "build-commands": [
                "./bootstrap.sh --prefix=/app --with-libraries=date_time,filesystem,iostreams,locale,regex,system,thread",
                "./b2 --build-type=minimal link=shared",
                "./b2 --build-type=minimal link=shared install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://boostorg.jfrog.io/artifactory/main/release/1.78.0/source/boost_1_78_0.tar.bz2",
                    "sha256": "8681f175d4bdb26c52222665793eef08490d7758529330f98d3b29dd0735bccc",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 6845,
                        "stable-only": true,
                        "url-template": "https://boostorg.jfrog.io/artifactory/main/release/$version/source/boost_${major}_${minor}_${patch}.tar.bz2"
                    }
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        {
            "name": "yaml-cpp",
            "buildsystem": "cmake-ninja",
            "cleanup": [
                "/include",
                "/lib/pkgconfig",
                "/lib/cmake"
            ],
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DBUILD_SHARED_LIBS=ON",
                "-DYAML_BUILD_SHARED_LIBS=ON",
                "-DYAML_CPP_BUILD_TOOLS=OFF",
                "-DYAML_CPP_BUILD_TESTS=OFF",
                "-DYAML_CPP_BUILD_CONTRIB=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jbeder/yaml-cpp/archive/refs/tags/yaml-cpp-0.7.0.tar.gz",
                    "sha256": "43e6a9fcb146ad871515f0d0873947e5d497a1c9c60c58cb102a97b47208b7c3"
                }
            ]
        },
        {
            "name": "pystring",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/imageworks/pystring/archive/281419de2f91f9e0f2df6acddfea3b06a43436be.tar.gz",
                    "sha256": "46161e75f85a3e8867233aebb6f4399f405c565db76dc07731a7ef662459609d"
                },
                {
                    "type": "file",
                    "path": "patches/pystring/CMakeLists.txt"
                }
            ]
        },
        {
            "name": "pybind11",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"pybind11\" --no-build-isolation"
            ],
            "cleanup": [
               "/bin"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/59/f6/aafe0b7e798f25632b199523cce98552fde53e8c552b9d96765426532d5f/pybind11-2.10.0.tar.gz",
                    "sha256": "18977589c10f595f65ec1be90b0a0763b43e458d25d97be9db75b958eb1f43fe"
                }
            ]
        },
        {
            "name": "expat",
            "//": "expat in the SDK can't be found with opencolorio. Do like Krita",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo"
            ],
            "cleanup": [
                "/bin"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/libexpat/libexpat/releases/download/R_2_4_8/expat-2.4.8.tar.gz",
                    "sha256": "398f6d95bf808d3108e27547b372cb4ac8dc2298a3c4251eb7aa3d4c6d4bb3e2"
                }
            ]
        },
        {
            "name": "imath",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DBUILD_TESTING=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/AcademySoftwareFoundation/Imath/archive/refs/tags/v3.1.3.tar.gz",
                    "sha256": "0bf7ec51162c4d17a4c5b850fb3f6f7a195cff9fa71f4da7735f74d7b5124320"
                }
            ],
            "cleanup": [
                "/include/Imath",
                "/lib/pkgconfig/Imath.pc"
            ]
        },
        {
            "name": "openexr",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DBUILD_SHARED_LIBS:BOOL=ON",
                "-DOPENEXR_BUILD_BOTH_STATIC_SHARED:BOOL=OFF",
                "-DBUILD_TESTING:BOOL=OFF"
            ],
            "post-install": [
                "ln -sf /app/include/Imath/* /app/include/OpenEXR/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/AcademySoftwareFoundation/openexr/archive/refs/tags/v3.1.3.tar.gz",
                    "sha256": "6f70a624d1321319d8269a911c4032f24950cde52e76f46e9ecbebfcb762f28c",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 13289,
                        "stable-only": true,
                        "url-template": "https://github.com/AcademySoftwareFoundation/openexr/archive/v$version.tar.gz"
                    }
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/cmake",
                "/lib/pkgconfig",
                "/share/aclocal",
                "/share/doc",
                "*.la"
            ]
        },
        {
            "name": "opencolorio",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "build-options" : {
                "cxxflags": "-Wno-error=unused-function -Wno-error=deprecated-declarations -Wno-error=cast-function-type",
                "arch" : {
                    "aarch64" : {
                        "config-opts" : [
                            "-DOCIO_USE_SSE:BOOL=OFF"
                        ]
                    }
                }
            },
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DOCIO_BUILD_APPS:BOOL=OFF",
                "-DOCIO_BUILD_DOCS:BOOL=OFF",
                "-DOCIO_BUILD_STATIC:BOOL=OFF",
                "-DOCIO_BUILD_TESTS:BOOL=OFF",
                "-DOCIO_INSTALL_EXT_PACKAGES=NONE"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/imageworks/OpenColorIO/archive/v2.1.2.tar.gz",
                    "sha256": "6c6d153470a7dbe56136073e7abea42fa34d06edc519ffc0a159daf9f9962b0b",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 9631,
                        "stable-only": true,
                        "url-template": "https://github.com/imageworks/OpenColorIO/archive/v$version.tar.gz"
                    }
                }
             ],
            "cleanup": [
                "/*.cmake",
                "/cmake",
                "/include",
                "/lib/pkgconfig",
                "/share"
            ]
        },
        {
            "name": "pugixml",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "cleanup": [
                "/include",
                "/lib/cmake",
                "*.a"
            ],
            "config-opts": [
                "-DBUILD_TESTING=OFF"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/zeux/pugixml",
                    "tag": "v1.12.1",
                    "commit": "dd50fa5b45ab8d58d6c27566c2eaf04a8b7e5841"
                }
            ]
        },
        {
            "name": "numpy",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/n/numpy/numpy-1.17.4.zip",
                    "sha256": "f58913e9227400f1395c7b800503ebfdb0772f1c33ff8cb4d6451c06cabdf316"
                }
            ],
            "cleanup": [
                "/bin",
                "/lib/python3.*/site-packages/numpy/core/include",
                "/lib/python3.*/site-packages/numpy/core/lib/libnpymath.a",
                "/lib/python3.*/site-packages/numpy/tests",
                "/lib/python3.*/site-packages/numpy/*/tests"
            ]
        },
        {
            "name": "openimageio",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DBUILD_TESTING=OFF",
                "-DOIIO_BUILD_TOOLS:BOOL=OFF",
                "-DOIIO_BUILD_TESTS:BOOL=OFF",
                "-DUSE_EXTERNAL_PUGIXML=ON",
                "-DINSTALL_DOCS:BOOL=OFF",
                "-DOpenGL_GL_PREFERENCE:STRING=GLVND",
                "-DUSE_DCMTK=OFF",
                "-DUSE_Libheif=OFF",
                "-DUSE_LibRaw=OFF",
                "-DUSE_OPENVDB=OFF",
                "-DUSE_Ptex=OFF",
                "-DUSE_Nuke=OFF",
                "-DUSE_LIBSQUISH=OFF",
                "-DUSE_QT5=OFF",
                "-DUSE_PYTHON:BOOL=OFF",
                "-DUSE_FFMPEG:BOOL=OFF",
                "-DUSE_OPENCV:BOOL=OFF"
            ],
            "modules": [
                {
                    "name": "fmt",
                    "buildsystem": "cmake-ninja",
                    "config-opts": [
                        "-DFMT_DOC=OFF",
                        "-DFMT_TEST=OFF"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://github.com/fmtlib/fmt/releases/download/9.0.0/fmt-9.0.0.zip",
                            "sha256": "fc96dd2d2fdf2bded630787adba892c23cb9e35c6fd3273c136b0c57d4651ad6"
                        }
                    ]
                },
                {
                    "name": "robin-map",
                    "buildsystem": "cmake-ninja",
                    "sources": [
                        {
                            "type": "git",
                            "url": "https://github.com/Tessil/robin-map.git",
                            "tag": "v1.0.1"
                        }
                    ]
                }
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/OpenImageIO/oiio/archive/refs/tags/v2.3.18.0.tar.gz",
                    "sha256": "09c7fa0685fdb34f696f2e5d44c2ba2336b5ca6ad8851cb516575508fe06397a",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 2548,
                        "stable-only": true,
                        "url-template": "https://github.com/OpenImageIO/oiio/archive/refs/tags/v$version.tar.gz"
                    }
                },
                {
                    "type": "patch",
                    "path": "patches/openimageio-jpegturbo.patch"
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        {
            "name": "opensubdiv",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DGLEW_LOCATION=/app",
                "-DNO_EXAMPLES=1",
                "-DNO_TUTORIALS=1",
                "-DNO_TESTS=ON",
                "-DNO_PTEX=1",
                "-DNO_DOC=1"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/PixarAnimationStudios/OpenSubdiv/archive/v3_4_4.tar.gz",
                    "sha256": "20d49f80a2b778ad4d01f091ad88d8c2f91cf6c7363940c6213241ce6f1048fb",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 96394,
                        "stable-only": true,
                        "url-template": "https://github.com/PixarAnimationStudios/OpenSubdiv/archive/v$version.tar.gz"
                    }
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/*.a",
                "/share"
            ]
        },
        {
            "name": "blosc",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DBUILD_BENCHMARKS:BOOL=OFF",
                "-DBUILD_STATIC:BOOL=OFF",
                "-DBUILD_TESTS:BOOL=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/Blosc/c-blosc/archive/refs/tags/v1.21.1.tar.gz",
                    "sha256": "f387149eab24efa01c308e4cba0f59f64ccae57292ec9c794002232f7903b55b"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/*.a",
                "/lib/pkgconfig"
            ]
        },
        {
            "name": "glfw",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DBUILD_SHARED_LIBS:BOOL=ON"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/glfw/glfw/releases/download/3.3.4/glfw-3.3.4.zip",
                    "sha256": "bbd2c42c660b725e9755eb417e40b373f0d4c03138c9b2e210d02cd308bd99cd"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/cmake",
                "/lib/pkgconfig"
            ]
        },
        {
            "name": "openvdb",
            "subdir": "openvdb",
            "buildsystem": "simple",
            "build-commands": [
                "make lib HDSO=/app/lib HT=/app DESTDIR=/app LOG4CPLUS_INCL_DIR= GLFW_INCL_DIR= PYTHON_VERSION= DOXYGEN= HALF_LIB=-lImath install_lib"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/AcademySoftwareFoundation/openvdb/archive/v7.0.0.tar.gz",
                    "sha256": "97bc8ae35ef7ccbf49a4e25cb73e8c2eccae6b235bac86f2150707efcd1e910d"
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "*.a"
            ]
        },
        {
            "name": "alembic",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DUSE_ARNOLD:BOOL=OFF",
                "-DUSE_BINARIES:BOOL=OFF",
                "-DUSE_EXAMPLES:BOOL=OFF",
                "-DUSE_HDF5:BOOL=OFF",
                "-DUSE_MAYA:BOOL=OFF",
                "-DUSE_PRMAN:BOOL=OFF",
                "-DUSE_PYALEMBIC:BOOL=OFF",
                "-DUSE_STATIC_HDF5:BOOL=OFF",
                "-DUSE_TESTS:BOOL=OFF",
                "-DALEMBIC_ILMBASE_LINK_STATIC:BOOL=OFF",
                "-DALEMBIC_SHARED_LIBS:BOOL=ON"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/alembic/alembic/archive/1.8.3.tar.gz",
                    "sha256": "b0bc74833bff118a869e81e6acb810a58797e77ef63143954b2f8e817c7f65cb"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/cmake"
            ]
        },
        {
            "name": "opencollada",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DUSE_EXPAT:BOOL=OFF",
                "-DUSE_LIBXML:BOOL=ON",
                "-DUSE_STATIC:BOOL=ON"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/KhronosGroup/OpenCOLLADA/archive/v1.6.68.tar.gz",
                    "sha256": "d9db0c0a518aa6ac0359626f222707c6ca1b63a83cbf229d97a5999c9cde347b",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 17055,
                        "stable-only": true,
                        "url-template": "https://github.com/KhronosGroup/OpenCOLLADA/archive/refs/tags/v$version.tar.gz"
                    }
                },
                {
                    "type": "patch",
                    "path": "patches/OpenCOLLADA-pcre.patch"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/opencollada"
            ]
        },
        {
            "name": "openimagedenoise",
            "only-arches": [
                "x86_64"
            ],
            "buildsystem": "cmake",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DOIDN_STATIC_LIB:BOOL=ON",
                "-DMKLDNN_BUILD_EXAMPLES:BOOL=OFF",
                "-DMKLDNN_BUILD_TESTS:BOOL=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/OpenImageDenoise/oidn/releases/download/v1.1.0/oidn-1.1.0.src.tar.gz",
                    "sha256": "4dd484abea8a0b3d12d346343fcb1ab7abef8f94318d8c537f69a20c2a75c4eb"
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "*.a",
                "/lib/cmake",
                "/share/doc"
            ]
        },
        {
            "name": "x264",
            "config-opts": [
                "--prefix=/app/lib/codecs",
                "--enable-lto",
                "--enable-pic",
                "--enable-shared",
                "--disable-cli"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://code.videolan.org/videolan/x264.git",
                    "branch": "stable",
                    "commit": "baee400fa9ced6f5481a728138fed6e867b0ff7f"
                }
            ],
            "cleanup": [
                "/lib/codecs/include",
                "/lib/codecs/lib/pkgconfig"
            ]
        },
        {
            "name": "ffmpeg",
            "build-options": {
                "env": {
                    "PKG_CONFIG_PATH": "/app/lib/codecs/lib/pkgconfig"
                }
            },
            "config-opts": [
                "--prefix=/app/lib/codecs",
                "--enable-shared",
                "--disable-static",
                "--disable-doc",
                "--enable-gpl",
                "--enable-version3",
                "--disable-nonfree",
                "--enable-optimizations",
                "--enable-pthreads",
                "--disable-bzlib",
                "--disable-libgsm",
                "--enable-libtheora",
                "--enable-libvorbis",
                "--enable-libvpx",
                "--enable-libx264",
                "--enable-zlib",
                "--disable-libxcb",
                "--disable-lzma",
                "--disable-programs",
                "--disable-network",
                "--disable-protocols",
                "--enable-protocol=file",
                "--disable-devices",
                "--enable-muxer=avi",
                "--enable-muxer=h264",
                "--enable-muxer=mov",
                "--enable-muxer=mp4",
                "--enable-muxer=ogg",
                "--enable-muxer=webm",
                "--enable-demuxer=avi",
                "--enable-demuxer=h264",
                "--enable-demuxer=mov",
                "--enable-demuxer=mp3",
                "--enable-demuxer=ogg",
                "--enable-demuxer=wav",
                "--enable-parser=h264",
                "--enable-parser=vorbis",
                "--enable-encoder=aac",
                "--enable-encoder=libtheora",
                "--enable-encoder=libvorbis",
                "--enable-encoder=libvpx_vp8",
                "--enable-encoder=libvpx_vp9",
                "--enable-encoder=libx264",
                "--enable-encoder=mpeg4",
                "--enable-decoder=aac",
                "--enable-decoder=h264",
                "--enable-decoder=libvorbis",
                "--enable-decoder=libvpx_vp8",
                "--enable-decoder=libvpx_vp9",
                "--enable-decoder=mp3",
                "--enable-decoder=mpeg4",
                "--enable-decoder=pcm_s16le",
                "--enable-decoder=theora"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.ffmpeg.org/releases/ffmpeg-5.0.1.tar.xz",
                    "sha256": "ef2efae259ce80a240de48ec85ecb062cecca26e4352ffb3fda562c21a93007b"
                }
            ],
            "cleanup": [
                "/lib/codecs/include",
                "/lib/codecs/lib/pkgconfig",
                "/lib/codecs/share"
            ]
        },
        {
            "name": "certifi",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/c/certifi/certifi-2019.9.11.tar.gz",
                    "sha256": "e4f3620cfea4f83eedc95b24abd9cd56f3c4b146dd0177e83a21b4eb49e21e50"
                }
            ]
        },
        {
            "name": "chardet",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/c/chardet/chardet-3.0.4.tar.gz",
                    "sha256": "84ab92ed1c4d4f16916e05906b6b75a6c0fb5db821cc65e70cbd64a3e2a5eaae"
                }
            ],
            "cleanup": [
                "/bin"
            ]
        },
        {
            "name": "idna",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/i/idna/idna-2.8.tar.gz",
                    "sha256": "c357b3f628cf53ae2c4c05627ecc484553142ca23264e593d327bcde5e9c3407"
                }
            ]
        },
        {
            "name": "urllib3",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/u/urllib3/urllib3-1.25.7.tar.gz",
                    "sha256": "f3c5fd51747d450d4dcf6f923c81f78f811aab8205fda64b0aba34a4e48b0745"
                }
            ]
        },
        {
            "name": "requests",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/r/requests/requests-2.22.0.tar.gz",
                    "sha256": "11e007a8a2aa0323f5a921e9e6a2d7e4e67d9877e85773fba9ba6419025cbeb4"
                }
            ]
        },
        {
            "name": "embree",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DEMBREE_ISPC_SUPPORT=OFF",
                "-DEMBREE_TUTORIALS=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/embree/embree/archive/refs/tags/v3.13.4.tar.gz",
                    "sha256": "e6a8d1d4742f60ae4d936702dd377bc4577a3b034e2909adb2197d0648b1cb35"
                }
            ]
        },
        {
            "name": "blender",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                /* Same as upstream official builds */
                "-DWITH_ALEMBIC:BOOL=ON",
                "-DWITH_ASSERT_ABORT:BOOL=OFF",
                "-DWITH_BUILDINFO:BOOL=ON",
                "-DWITH_BULLET:BOOL=ON",
                "-DWITH_CODEC_AVI:BOOL=ON",
                "-DWITH_CODEC_FFMPEG:BOOL=ON",
                "-DWITH_CODEC_SNDFILE:BOOL=ON",
                "-DWITH_CYCLES:BOOL=ON",
                "-DWITH_CYCLES_OSL:BOOL=ON",
                "-DWITH_DRACO:BOOL=ON",
                "-DWITH_FFTW3:BOOL=ON",
                "-DWITH_LIBMV:BOOL=ON",
                "-DWITH_LIBMV_SCHUR_SPECIALIZATIONS:BOOL=ON",
                "-DWITH_COMPOSITOR:BOOL=ON",
                "-DWITH_FREESTYLE:BOOL=ON",
                "-DWITH_GHOST_XDND:BOOL=ON",
                "-DWITH_IK_SOLVER:BOOL=ON",
                "-DWITH_IK_ITASC:BOOL=ON",
                "-DWITH_IMAGE_CINEON:BOOL=ON",
                "-DWITH_IMAGE_DDS:BOOL=ON",
                "-DWITH_IMAGE_HDR:BOOL=ON",
                "-DWITH_IMAGE_OPENEXR:BOOL=ON",
                "-DWITH_IMAGE_OPENJPEG:BOOL=ON",
                "-DWITH_IMAGE_TIFF:BOOL=ON",
                "-DWITH_INTERNATIONAL:BOOL=ON",
                "-DWITH_LZMA:BOOL=ON",
                "-DWITH_LZO:BOOL=ON",
                "-DWITH_MOD_FLUID:BOOL=ON",
                "-DWITH_MOD_REMESH:BOOL=ON",
                "-DWITH_MOD_SMOKE:BOOL=ON",
                "-DWITH_MOD_OCEANSIM:BOOL=ON",
                "-DWITH_AUDASPACE:BOOL=ON",
                "-DWITH_OPENAL:BOOL=ON",
                "-DWITH_OPENCOLLADA:BOOL=ON",
                "-DWITH_OPENCOLORIO:BOOL=ON",
                "-DWITH_OPENIMAGEDENOISE:BOOL=ON",
                "-DWITH_OPENMP:BOOL=ON",
                "-DWITH_OPENSUBDIV:BOOL=ON",
                "-DWITH_OPENVDB:BOOL=ON",
                "-DWITH_OPENVDB_BLOSC:BOOL=ON",
                "-DWITH_QUADRIFLOW:BOOL=ON",
                "-DWITH_RAYOPTIMIZATION:BOOL=ON",
                "-DWITH_SDL:BOOL=ON",
                "-DWITH_TBB:BOOL=ON",
                "-DWITH_X11_XINPUT:BOOL=ON",
                "-DWITH_X11_XF86VMODE:BOOL=ON",
                "-DWITH_MEM_JEMALLOC:BOOL=ON",
                "-DWITH_CYCLES_CUDA_BINARIES:BOOL=ON",
                "-DWITH_CYCLES_CUBIN_COMPILER:BOOL=OFF",
                "-DCYCLES_CUDA_BINARIES_ARCH:STRING=sm_30;sm_35;sm_37;sm_50;sm_52;sm_60;sm_61;sm_70;sm_75",
                "-DWITH_CYCLES_DEVICE_OPTIX:BOOL=ON",

                /* Changed from upstream official builds */
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DPYTHON_NUMPY_PATH:PATH=/app/lib/python3.10/site-packages",
                "-DPYTHON_NUMPY_INCLUDE_DIRS=/app/lib/python3.10/site-packages/numpy/core/include",
                "-DPYTHON_LIBRARY=/usr/lib/python3.10",
                "-DPYTHON_INCLUDE_DIR=/usr/include/python3.10",
                "-DWITH_DOC_MANPAGE:BOOL=OFF",
                "-DWITH_INPUT_NDOF:BOOL=OFF",
                "-DWITH_INSTALL_PORTABLE:BOOL=OFF",
                "-DWITH_JACK:BOOL=OFF",
                "-DWITH_PYTHON_INSTALL:BOOL=OFF"
            ],
            "post-install": [
                "install -Dm644 ../org.blender.Blender.appdata.xml -t /app/share/appdata"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/blender/blender/archive/refs/tags/v3.2.2.tar.gz",
                    "sha256": "7e169e00789a12677a6bd1dac4dee43f666fa763fd7ab840b2fef6a56e24b566",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 201,
                        "stable-only": true,
                        "url-template": "https://github.com/blender/blender/archive/refs/tags/v$version.tar.gz"
                    }
                },
                {
                    "type": "patch",
                    "path": "patches/blender-desktop-add-wm-class.patch"
                },
                {
                    "type": "file",
                    "path": "org.blender.Blender.appdata.xml"
                }
            ],
            "cleanup": [
                "/bin/blender-thumbnailer.py",
                "/share/blender/*/scripts/addons/cycles/source",
                "/share/doc"
            ]
        }
    ]
}
